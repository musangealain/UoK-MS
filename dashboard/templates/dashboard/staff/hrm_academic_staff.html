{% extends "dashboard/staff/base.html" %}
{% block title %}Academic Staff (Lecturers){% endblock %}

{% block main %}
  <section class="page-header">
    <div>
      <h1>Academic Staff (Lecturers)</h1>
      <p>Assign lecturers to modules, replace them, or stop access when necessary.</p>
    </div>
    <div class="quick-actions">
      <a class="ghost-btn" href="{% url 'staff_office_dashboard' office_code=office_code %}">Back to Office Overview</a>
    </div>
  </section>

  {% if lecturer_hire_result or lecturer_hire_error %}
    <section class="panel panel-tight">
      <div class="panel-header">
        <h2>Updates</h2>
        <span class="panel-pill">HRM</span>
      </div>
      {% if lecturer_hire_result %}
        <div class="notice notice-success">
          {{ lecturer_action|default:"Updated" }} lecturer for <strong>{{ lecturer_hire_result.full_name }}</strong> ({{ lecturer_hire_result.module_code }}).
          Lecturer ID: <code>{{ lecturer_hire_result.lecturer_id }}</code> &middot; Password: <code>{{ lecturer_hire_result.password }}</code>
        </div>
      {% endif %}
      {% if lecturer_hire_error %}
        <div class="notice notice-error">{{ lecturer_hire_error }}</div>
      {% endif %}
    </section>
  {% endif %}

  <section class="panel">
    <div class="panel-header">
      <div>
        <h2>Assign Lecturer</h2>
        <p class="panel-sub">Lecturer ID format: LEC[YY]-[Sequence] (example: LEC26-003).</p>
      </div>
      <span class="panel-pill">Lecturer IDs</span>
    </div>
    <form class="inline-form" method="post" action="{% url 'staff_office_module' office_code=office_code module_slug=module.slug %}">
      {% csrf_token %}
      <input type="hidden" name="action" value="hire_lecturer">
      <div class="form-grid">
        <label class="form-field" for="module-code-hire">
          Module Code / Name
          <select class="input" id="module-code-hire" name="module_code" required>
            {% for code, name in module_choices %}
              <option value="{{ code }}">{{ code }} — {{ name }}</option>
            {% endfor %}
          </select>
        </label>

        <label class="form-field" for="first-name-hire">
          First name
          <input class="input" id="first-name-hire" type="text" name="first_name" placeholder="e.g., Jane" required>
        </label>

        <label class="form-field" for="surname-hire">
          Surname (optional)
          <input class="input" id="surname-hire" type="text" name="surname" placeholder="e.g., Marie">
        </label>

        <label class="form-field" for="last-name-hire">
          Last name
          <input class="input" id="last-name-hire" type="text" name="last_name" placeholder="e.g., Doe" required>
        </label>

        <button class="primary-btn form-action-btn" type="submit">Hire / Generate Lecturer ID</button>
      </div>
    </form>
  </section>

  <section class="panel">
    <div class="panel-header">
      <h2>Module Lecturer Assignments</h2>
    </div>
    <div class="table-wrap">
      <table class="dashboard-table">
        <thead>
          <tr>
            <th>Module Code</th>
            <th>Module Name</th>
            <th>Current Lecturer</th>
            <th>Lecturer ID</th>
            <th>Password</th>
            <th>Assigned</th>
          </tr>
        </thead>
        <tbody>
          {% for row in module_rows %}
            <tr>
              <td>{{ row.code }}</td>
              <td>{{ row.name }}</td>
              <td>{{ row.lecturer.full_name|default:"-" }}</td>
              <td>{{ row.lecturer.lecturer_id|default:"-" }}</td>
              <td>{{ row.lecturer.assigned_password|default:"-" }}</td>
              <td>{{ row.lecturer.created_at|date:"Y-m-d"|default:"-" }}</td>
            </tr>
          {% empty %}
            <tr>
              <td colspan="6">No module assignments found.</td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </section>

  <section class="panel">
    <div class="panel-header">
      <h2>Replace Lecturer</h2>
    </div>
    <form class="inline-form" method="post" action="{% url 'staff_office_module' office_code=office_code module_slug=module.slug %}">
      {% csrf_token %}
      <input type="hidden" name="action" value="replace_lecturer">
      <div class="form-grid">
        <label class="form-field" for="module-code-replace">
          Module Code / Name
          <select class="input" id="module-code-replace" name="module_code" required>
            {% for code, name in module_choices %}
              <option value="{{ code }}">{{ code }} — {{ name }}</option>
            {% endfor %}
          </select>
        </label>

        <label class="form-field" for="first-name-replace">
          First name
          <input class="input" id="first-name-replace" type="text" name="first_name" placeholder="e.g., Jane" required>
        </label>

        <label class="form-field" for="surname-replace">
          Surname (optional)
          <input class="input" id="surname-replace" type="text" name="surname" placeholder="e.g., Marie">
        </label>

        <label class="form-field" for="last-name-replace">
          Last name
          <input class="input" id="last-name-replace" type="text" name="last_name" placeholder="e.g., Doe" required>
        </label>

        <button class="primary-btn form-action-btn" type="submit">Replace Lecturer</button>
      </div>
    </form>
  </section>

  <section class="panel">
    <div class="panel-header">
      <h2>Stop Access</h2>
    </div>
    <form class="inline-form" method="post" action="{% url 'staff_office_module' office_code=office_code module_slug=module.slug %}">
      {% csrf_token %}
      <input type="hidden" name="action" value="deactivate_lecturer">
      <div class="form-grid">
        <label class="form-field" for="module-code-stop">
          Module Code / Name
          <select class="input" id="module-code-stop" name="module_code" required>
            {% for code, name in module_choices %}
              <option value="{{ code }}">{{ code }} — {{ name }}</option>
            {% endfor %}
          </select>
        </label>

        <button class="ghost-btn form-action-btn stop-access-btn" type="submit">Stop Access</button>
      </div>
    </form>
  </section>
{% endblock %}
